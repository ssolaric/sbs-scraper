/// <reference lib="dom" />
import * as cheerio from "cheerio";

async function requestExchangeRates(date: string) {
  const requestBody = `ctl00%24MainScriptManager=ctl00%24cphContent%24updConsulta%7Cctl00%24cphContent%24btnConsultar&ctl00_MainScriptManager_TSM=%3B%3BSystem.Web.Extensions%2C%20Version%3D4.0.0.0%2C%20Culture%3Dneutral%2C%20PublicKeyToken%3D31bf3856ad364e35%3Aen-US%3Ab7585254-495e-4311-9545-1f910247aca5%3Aea597d4b%3Ab25378d2%3BTelerik.Web.UI%3Aen-US%3Aab312d5a-8d8b-4310-a879-b25aeb34b5c7%3A16e4e7cd%3Af7645509%3A22a6274a%3A88144a7a%3A8674cba1%3A7c926187%3Ab7778d6c%3Ac08e9f8a%3A59462f1%3Aa51ee93e%3A58366029%3A24ee1bba%3Ae330518b%3A2003d0b8%3Ac128760b%3A1e771326%3Ac8618e41%3Ae4f8f289%3A1a73651d%3A333f8d94%3B&ctl00%24cphContent%24rdpDate=${date}&ctl00%24cphContent%24rdpDate%24dateInput=14%2F02%2F2023&ctl00_cphContent_rdpDate_dateInput_ClientState=%7B%22enabled%22%3Atrue%2C%22emptyMessage%22%3A%22%22%2C%22validationText%22%3A%22${date}-00-00-00%22%2C%22valueAsString%22%3A%22${date}-00-00-00%22%2C%22minDateStr%22%3A%221000-01-01-00-00-00%22%2C%22maxDateStr%22%3A%222023-02-21-00-00-00%22%2C%22lastSetTextBoxValue%22%3A%2214%2F02%2F2023%22%7D&ctl00_cphContent_rdpDate_calendar_SD=%5B%5B2023%2C2%2C14%5D%5D&ctl00_cphContent_rdpDate_calendar_AD=%5B%5B1000%2C1%2C1%5D%2C%5B2023%2C2%2C21%5D%2C%5B2023%2C2%2C21%5D%5D&ctl00_cphContent_rdpDate_ClientState=%7B%22minDateStr%22%3A%221000-01-01-00-00-00%22%2C%22maxDateStr%22%3A%222023-02-21-00-00-00%22%7D&ctl00_cphContent_rgTipoCambio_rghcMenu_ClientState=&ctl00_cphContent_rgTipoCambio_ClientState=&__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwULLTEyOTgxNDkwOTkPZBYCZg9kFgICAw9kFgICAw9kFgICAQ9kFgJmD2QWCgIBDw8WAh4EVGV4dAUXVElQTyBERSBDQU1CSU8gQ09OVEFCTEVkZAIDDw8WDB4MU2VsZWN0ZWREYXRlBgAAwMD5CtsIHhxFbmFibGVFbWJlZGRlZEJhc2VTdHlsZXNoZWV0Zx4HTWluRGF0ZQYAwI5nmAFgBB4HTWF4RGF0ZQYAQEuTnhPbCB4SUmVzb2x2ZWRSZW5kZXJNb2RlCylyVGVsZXJpay5XZWIuVUkuUmVuZGVyTW9kZSwgVGVsZXJpay5XZWIuVUksIFZlcnNpb249MjAxNi4xLjIyNS40MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0xMjFmYWU3ODE2NWJhM2Q0AR4VRW5hYmxlRW1iZWRkZWRTY3JpcHRzZ2QWBGYPFCsACA8WGB4NTGFiZWxDc3NDbGFzcwUHcmlMYWJlbB4MRW1wdHlNZXNzYWdlZR8ABRMyMDIzLTAyLTEwLTAwLTAwLTAwHwJnHwMGAMCOZ5gBYAQfBAYAQEuTnhPbCB4RX3NraXBNTVZhbGlkYXRpb25oHgRTa2luBQVNZXRybx4XRW5hYmxlQWpheFNraW5SZW5kZXJpbmdoHwZnHwULKwQBHhFFbmFibGVBcmlhU3VwcG9ydGhkFggeBVdpZHRoGwAAAAAAAFlABwAAAB4KUmVzaXplTW9kZQspclRlbGVyaWsuV2ViLlVJLlJlc2l6ZU1vZGUsIFRlbGVyaWsuV2ViLlVJLCBWZXJzaW9uPTIwMTYuMS4yMjUuNDAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MTIxZmFlNzgxNjViYTNkNAAeCENzc0NsYXNzBRFyaVRleHRCb3ggcmlIb3Zlch4EXyFTQgKCAhYIHw0bAAAAAAAAWUAHAAAAHw4LKwUAHw8FEXJpVGV4dEJveCByaUVycm9yHxACggIWCB8NGwAAAAAAAFlABwAAAB8OCysFAB8PBRNyaVRleHRCb3ggcmlGb2N1c2VkHxACggIWBh8NGwAAAAAAAFlABwAAAB8PBRNyaVRleHRCb3ggcmlFbmFibGVkHxACggIWCB8NGwAAAAAAAFlABwAAAB8OCysFAB8PBRRyaVRleHRCb3ggcmlEaXNhYmxlZB8QAoICFggfDRsAAAAAAABZQAcAAAAfDgsrBQAfDwURcmlUZXh0Qm94IHJpRW1wdHkfEAKCAhYIHw0bAAAAAAAAWUAHAAAAHw4LKwUAHw8FEHJpVGV4dEJveCByaVJlYWQfEAKCAmQCAg8UKwANDxYUBQ1DdWx0dXJlSW5mb0lEKCltU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQVlcy1FUwUNU2VsZWN0ZWREYXRlcw8FjwFUZWxlcmlrLldlYi5VSS5DYWxlbmRhci5Db2xsZWN0aW9ucy5EYXRlVGltZUNvbGxlY3Rpb24sIFRlbGVyaWsuV2ViLlVJLCBWZXJzaW9uPTIwMTYuMS4yMjUuNDAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MTIxZmFlNzgxNjViYTNkNBQrAAEGAADAwPkK2wgFBEZvY0QGAEBLk54T2wgFEUVuYWJsZU11bHRpU2VsZWN0aAUPUmVuZGVySW52aXNpYmxlZwUNQ3VsdHVyZU5hbWVJRAUFZXMtRVMFC1NwZWNpYWxEYXlzDwWSAVRlbGVyaWsuV2ViLlVJLkNhbGVuZGFyLkNvbGxlY3Rpb25zLkNhbGVuZGFyRGF5Q29sbGVjdGlvbiwgVGVsZXJpay5XZWIuVUksIFZlcnNpb249MjAxNi4xLjIyNS40MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0xMjFmYWU3ODE2NWJhM2Q0FCsAARYGBQNJU1ILKYABVGVsZXJpay5XZWIuVUkuQ2FsZW5kYXIuUmVjdXJyaW5nRXZlbnRzLCBUZWxlcmlrLldlYi5VSSwgVmVyc2lvbj0yMDE2LjEuMjI1LjQwLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTEyMWZhZTc4MTY1YmEzZDQQBQFFaAUJSXRlbVN0eWxlDwV3U3lzdGVtLldlYi5VSS5XZWJDb250cm9scy5UYWJsZUl0ZW1TdHlsZSwgU3lzdGVtLldlYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWIwM2Y1ZjdmMTFkNTBhM2EWBB8PBQdyY1RvZGF5HxACAgUETWluRAYAwI5nmAFgBAUJQ3VsdHVyZUlEAooYBQRNYXhEBgBAS5OeE9sIDxYMHwZnHwJnHwxoHwoFBU1ldHJvHwULKwQBHwtoZGQWBB8PBQtyY01haW5UYWJsZR8QAgIWBB8PBQxyY090aGVyTW9udGgfEAICZBYEHw8FCnJjU2VsZWN0ZWQfEAICZBYEHw8FCnJjRGlzYWJsZWQfEAICFgQfDwUMcmNPdXRPZlJhbmdlHxACAhYEHw8FCXJjV2Vla2VuZB8QAgIWBB8PBQdyY0hvdmVyHxACAhYEHw8FL1JhZENhbGVuZGFyTW9udGhWaWV3IFJhZENhbGVuZGFyTW9udGhWaWV3X01ldHJvHxACAhYEHw8FCXJjVmlld1NlbB8QAgJkAgkPZBYCZg9kFgICAQ8PFgIfAAUcVGlwbyBkZSBDYW1iaW8gYWwgMTAvMDIvMjAyM2RkAgsPDxYCHgdWaXNpYmxlZ2QWAgIBDzwrAA4CABQrAAIPFgweC18hSXRlbUNvdW50AgEfC2gfAmcfBQsrBAEfBmceC18hRGF0YUJvdW5kZ2QXAwUTU2VsZWN0ZWRDZWxsSW5kZXhlcxYABQ9TZWxlY3RlZEluZGV4ZXMWAAULRWRpdEluZGV4ZXMWAAEWAhYLDwIEFCsABBQrAAUWBB4IRGF0YVR5cGUZKwIeBG9pbmQCAmRkZAULc3RyX2Rlc1BhaXMUKwAFFgQfFBkrAh8VAgNkZGQFDXN0cl9kZXNNb25lZGEUKwAFFgQfFBkrAh8VAgRkZGQFEHN0cl9udW1Db3RpU29sZXMUKwAFFgYfEWgfFBkrAh8VAgVkZGQFEHN0cl9udW1Db3RpRG9sYXJkZRQrAAALKXlUZWxlcmlrLldlYi5VSS5HcmlkQ2hpbGRMb2FkTW9kZSwgVGVsZXJpay5XZWIuVUksIFZlcnNpb249MjAxNi4xLjIyNS40MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0xMjFmYWU3ODE2NWJhM2Q0ATwrAAcACyl0VGVsZXJpay5XZWIuVUkuR3JpZEVkaXRNb2RlLCBUZWxlcmlrLldlYi5VSSwgVmVyc2lvbj0yMDE2LjEuMjI1LjQwLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTEyMWZhZTc4MTY1YmEzZDQBFgIeBF9lZnNkZBYQHgpEYXRhTWVtYmVyZR8SAiseBV9xZWx0GSlwU0lTVElQLk1vZGVsby5FbnRpZGFkZXMuVGlwb0NhbWJpb0NvbnRhYmxlLCBTSVNUSVAuTW9kZWxvLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbB4USXNCb3VuZFRvRm9yd2FyZE9ubHloHgVfIUNJUxcAHgRfaGxtCysIAR8TZx4IRGF0YUtleXMWABQrAAQPAgMCAxQrAAIWAh4VQ29sdW1uR3JvdXBIZWFkZXJUZXh0BRpFc3RhZG9zIFVuaWRvcyBkZSBBbcOpcmljYWQUKwACFgIfHQUORMOzbGFyIGRlIE4uQS5kFCsAAhYCHx0FBjMuODU2MGRmFghmDxQrAAMPZBYCHgVzdHlsZQULd2lkdGg6MTAwJTtkZGQCAQ8WBRQrAAIPFhAfF2UfEgIrHxgZKwofGWgfGhcAHxsLKwgBHxNnHxwWAGQXAwUGXyFEU0lDAisFCF8hUENvdW50ZAULXyFJdGVtQ291bnQCKxYCHgNfc2UWAh4CX2NmZBYEZGRkZBYCZ2cWAmYPZBawAWYPZBYEZg9kFgpmDw8WBh4HUm93U3BhbgICHwAFBiZuYnNwOx8RaGRkAgEPDxYGHyECAh8ABQYmbmJzcDsfEWhkZAICDw8WBB8ABRpFc3RhZG9zIFVuaWRvcyBkZSBBbcOpcmljYR4KQ29sdW1uU3BhbgIBZGQCAw8PFgQfAAUORMOzbGFyIGRlIE4uQS4fIgIBZGQCBA8PFgQfAAUGMy44NTYwHyICAWRkAgEPZBYIZg8PFgQfIQIBHwAFBFBBSVNkZAIBDw8WBB8hAgEfAAUGTU9ORURBZGQCAg8PFgQfIQIBHwAFFlRJUE8gREUgQ0FNQklPIChFbiBTLylkZAIDDw8WBh8hAgEfAAUaVElQTyBERSBDQU1CSU8gKEVuIFVTJCkgMS8fEWhkZAIBDw8WAh8RaGQWAmYPZBYMZg8PFgIfAAUGJm5ic3A7ZGQCAQ8PFgIfAAUGJm5ic3A7ZGQCAg8PFgIfAAUGJm5ic3A7ZGQCAw8PFgIfAAUGJm5ic3A7ZGQCBA8PFgIfAAUGJm5ic3A7ZGQCBQ8PFgIfAAUGJm5ic3A7ZGQCAg8PFgIeBF9paWgFATBkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFDlVuacOzbiBFdXJvcGVhZGQCAw8PFgIfAAUERXVyb2RkAgQPDxYCHwAFCDQuMTE1MjYyZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCAw9kFgJmDw8WAh8RaGRkAgQPDxYCHyMFATFkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFCUFyZ2VudGluYWRkAgMPDxYCHwAFDlBlc28gQXJnZW50aW5vZGQCBA8PFgIfAAUIMC4wMjAyNDBkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAIFD2QWAmYPDxYCHxFoZGQCBg8PFgIfIwUBMmQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUJQXVzdHJhbGlhZGQCAw8PFgIfAAUSRMOzbGFyIEF1c3RyYWxpYW5vZGQCBA8PFgIfAAUIMi42NjY4NTJkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAIHD2QWAmYPDxYCHxFoZGQCCA8PFgIfIwUBM2QWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUKQmFuZ2xhZGVzaGRkAgMPDxYCHwAFEFRha2EgQmFuZ2xhZGVzw61kZAIEDw8WAh8ABQgwLjAzNzA5OWRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAgkPZBYCZg8PFgIfEWhkZAIKDw8WAh8jBQE0ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABSBCb2xpdmlhLCBFc3RhZG8gUGx1cmluYWNpb25hbCBkZWRkAgMPDxYCHwAFCUJvbGl2aWFub2RkAgQPDxYCHwAFCDAuNTYyOTE4ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCCw9kFgJmDw8WAh8RaGRkAgwPDxYCHyMFATVkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFBkJyYXNpbGRkAgMPDxYCHwAFBFJlYWxkZAIEDw8WAh8ABQgwLjczNzIxM2RkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAg0PZBYCZg8PFgIfEWhkZAIODw8WAh8jBQE2ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQhCdWxnYXJpYWRkAgMPDxYCHwAFA0xldmRkAgQPDxYCHwAFCDIuMTA3NDUxZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCDw9kFgJmDw8WAh8RaGRkAhAPDxYCHyMFATdkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB0NhbmFkw6FkZAIDDw8WAh8ABRFEw7NsYXIgQ2FuYWRpZW5zZWRkAgQPDxYCHwAFCDIuODg1Nzk2ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCEQ9kFgJmDw8WAh8RaGRkAhIPDxYCHyMFAThkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFBUNoaWxlZGQCAw8PFgIfAAUMUGVzbyBDaGlsZW5vZGQCBA8PFgIfAAUIMC4wMDQ4NDNkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAITD2QWAmYPDxYCHxFoZGQCFA8PFgIfIwUBOWQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUFQ2hpbmFkZAIDDw8WAh8ABRRZdWFuIENoaW5vIE9mZi1TaG9yZWRkAgQPDxYCHwAFCDAuNTY0OTczZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCFQ9kFgJmDw8WAh8RaGRkAhYPDxYCHyMFAjEwZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQVDaGluYWRkAgMPDxYCHwAFBFl1YW5kZAIEDw8WAh8ABQgwLjU2NjA2MWRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAhcPZBYCZg8PFgIfEWhkZAIYDw8WAh8jBQIxMWQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUIQ29sb21iaWFkZAIDDw8WAh8ABQ9QZXNvIENvbG9tYmlhbm9kZAIEDw8WAh8ABQgwLjAwMDgwMmRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAhkPZBYCZg8PFgIfEWhkZAIaDw8WAh8jBQIxMmQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUFQ29uZ29kZAIDDw8WAh8ABR1GcmFuY28gQ2ZhIGRlIMOBZnJpY2EgQ2VudHJhbGRkAgQPDxYCHwAFCDAuMDA2Mjc0ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCGw9kFgJmDw8WAh8RaGRkAhwPDxYCHyMFAjEzZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABRpDb3JlYSwgUmVww7pibGljYSBkZSAoU3VyKWRkAgMPDxYCHwAFDldvbiBTdXJjb3JlYW5vZGQCBA8PFgIfAAUIMC4wMDMwNTBkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAIdD2QWAmYPDxYCHxFoZGQCHg8PFgIfIwUCMTRkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFCkNvc3RhIFJpY2FkZAIDDw8WAh8ABRRDb2zDs24gZGUgQ29zdGEgUmljYWRkAgQPDxYCHwAFCDAuMDA2NzIxZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCHw9kFgJmDw8WAh8RaGRkAiAPDxYCHyMFAjE1ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQlEaW5hbWFyY2FkZAIDDw8WAh8ABQ1Db3JvbmEgRGFuZXNhZGQCBA8PFgIfAAUIMC41NTI1NTNkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAIhD2QWAmYPDxYCHxFoZGQCIg8PFgIfIwUCMTZkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB0VjdWFkb3JkZAIDDw8WAh8ABQ5Ew7NsYXIgZGUgTi5BLmRkAgQPDxYCHwAFCDMuODU2MDAwZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCIw9kFgJmDw8WAh8RaGRkAiQPDxYCHyMFAjE3ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABRdFbWlyYXRvcyDDgXJhYmVzIFVuaWRvc2RkAgMPDxYCHwAFBkRpcmhhbWRkAgQPDxYCHwAFCDEuMDQ5ODUwZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCJQ9kFgJmDw8WAh8RaGRkAiYPDxYCHyMFAjE4ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABRhGZWRlcmFjacOzbiBSdXNhIChSdXNpYSlkZAIDDw8WAh8ABQVSdWJsb2RkAgQPDxYCHwAFCDAuMDUyNzA4ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCJw9kFgJmDw8WAh8RaGRkAigPDxYCHyMFAjE5ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQlGaWxpcGluYXNkZAIDDw8WAh8ABRFQZXNvIGRlIEZpbGlwaW5hc2RkAgQPDxYCHwAFCDAuMDcwODY5ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCKQ9kFgJmDw8WAh8RaGRkAioPDxYCHyMFAjIwZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQlHdWF0ZW1hbGFkZAIDDw8WAh8ABQdRdWV0emFsZGQCBA8PFgIfAAUIMC40OTIxMzBkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAIrD2QWAmYPDxYCHxFoZGQCLA8PFgIfIwUCMjFkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFCUhvbmcgS29uZ2RkAgMPDxYCHwAFE0TDs2xhciBkZSBIb25nIEtvbmdkZAIEDw8WAh8ABQgwLjQ5MTIyN2RkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAi0PZBYCZg8PFgIfEWhkZAIuDw8WAh8jBQIyMmQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUFSW5kaWFkZAIDDw8WAh8ABRFSdXBpYSBkZSBsYSBJbmRpYWRkAgQPDxYCHwAFCDAuMDQ2NzM5ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCLw9kFgJmDw8WAh8RaGRkAjAPDxYCHyMFAjIzZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQlJbmRvbmVzaWFkZAIDDw8WAh8ABRJSdXBpYSBkZSBJbmRvbmVzaWFkZAIEDw8WAh8ABQgwLjAwMDI1NGRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAjEPZBYCZg8PFgIfEWhkZAIyDw8WAh8jBQIyNGQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUGSmFww7NuZGQCAw8PFgIfAAUMWWVuIEphcG9uw6lzZGQCBA8PFgIfAAUIMC4wMjkzMTNkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAIzD2QWAmYPDxYCHxFoZGQCNA8PFgIfIwUCMjVkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB01hbGFzaWFkZAIDDw8WAh8ABRhEw7NsYXIgTWFsYXNpbyBvIFJpbmdnaXRkZAIEDw8WAh8ABQgwLjg5MDExOWRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAjUPZBYCZg8PFgIfEWhkZAI2Dw8WAh8jBQIyNmQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUHTcOpeGljb2RkAgMPDxYCHwAFDVBlc28gTWV4aWNhbm9kZAIEDw8WAh8ABQgwLjIwNjM1OGRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAjcPZBYCZg8PFgIfEWhkZAI4Dw8WAh8jBQIyN2QWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUHTmFtaWJpYWRkAgMPDxYCHwAFDkTDs2xhciBOYW1pYmlvZGQCBA8PFgIfAAUIMC4yMTU0MjNkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAI5D2QWAmYPDxYCHxFoZGQCOg8PFgIfIwUCMjhkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB05pZ2VyaWFkZAIDDw8WAh8ABQ9OYWlyYSBOaWdlcmlhbmFkZAIEDw8WAh8ABQgwLjAwODM2MGRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAjsPZBYCZg8PFgIfEWhkZAI8Dw8WAh8jBQIyOWQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUHTm9ydWVnYWRkAgMPDxYCHwAFDkNvcm9uYSBOb3J1ZWdhZGQCBA8PFgIfAAUIMC4zNzkzMTlkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAI9D2QWAmYPDxYCHxFoZGQCPg8PFgIfIwUCMzBkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB1BhbmFtw6FkZAIDDw8WAh8ABQZCYWxib2FkZAIEDw8WAh8ABQgzLjg1NjAwMGRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAj8PZBYCZg8PFgIfEWhkZAJADw8WAh8jBQIzMWQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUIUGFyYWd1YXlkZAIDDw8WAh8ABQhHdWFyYW7DrWRkAgQPDxYCHwAFCDAuMDAwNTI4ZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCQQ9kFgJmDw8WAh8RaGRkAkIPDxYCHyMFAjMyZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQdQb2xvbmlhZGQCAw8PFgIfAAUMWmxvdHkgUG9sYWNvZGQCBA8PFgIfAAUIMC44NjE2OTZkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJDD2QWAmYPDxYCHxFoZGQCRA8PFgIfIwUCMzNkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFC1JlaW5vIFVuaWRvZGQCAw8PFgIfAAUPTGlicmEgRXN0ZXJsaW5hZGQCBA8PFgIfAAUINC42NDgwMjJkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJFD2QWAmYPDxYCHxFoZGQCRg8PFgIfIwUCMzRkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFFVJlcMO6YmxpY2EgRG9taW5pY2FuYWRkAgMPDxYCHwAFHVBlc28gZGUgUmVww7pibGljYSBEb21pbmljYW5hZGQCBA8PFgIfAAUIMC4wNjg5NDlkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJHD2QWAmYPDxYCHxFoZGQCSA8PFgIfIwUCMzVkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFClN1ZMOhZnJpY2FkZAIDDw8WAh8ABQRSYW5kZGQCBA8PFgIfAAUIMC4yMTU0MjNkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJJD2QWAmYPDxYCHxFoZGQCSg8PFgIfIwUCMzZkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFBlN1ZWNpYWRkAgMPDxYCHwAFDENvcm9uYSBTdWVjYWRkAgQPDxYCHwAFCDAuMzY4MjAyZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCSw9kFgJmDw8WAh8RaGRkAkwPDxYCHyMFAjM3ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQVTdWl6YWRkAgMPDxYCHwAFDEZyYW5jbyBTdWl6b2RkAgQPDxYCHwAFCDQuMTY5NTUxZGQCBQ8PFgQfAAUGJm5ic3A7HxFoZGQCTQ9kFgJmDw8WAh8RaGRkAk4PDxYCHyMFAjM4ZBYMZg8PFgIfEWhkZAIBDw8WBB8ABQYmbmJzcDsfEWhkZAICDw8WAh8ABQlUYWlsYW5kaWFkZAIDDw8WAh8ABQRCYWh0ZGQCBA8PFgIfAAUIMC4xMTQyODBkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJPD2QWAmYPDxYCHxFoZGQCUA8PFgIfIwUCMzlkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFG1RhaXfDoW4sIFByb3ZpbmNpYSBkZSBDaGluYWRkAgMPDxYCHwAFFk51ZXZvIETDs2xhciBkZSBUYWl3YW5kZAIEDw8WAh8ABQgwLjEyODA2NWRkAgUPDxYEHwAFBiZuYnNwOx8RaGRkAlEPZBYCZg8PFgIfEWhkZAJSDw8WAh8jBQI0MGQWDGYPDxYCHxFoZGQCAQ8PFgQfAAUGJm5ic3A7HxFoZGQCAg8PFgIfAAUIVHVycXXDrWFkZAIDDw8WAh8ABQRMaXJhZGQCBA8PFgIfAAUIMC4yMDQ3OTJkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJTD2QWAmYPDxYCHxFoZGQCVA8PFgIfIwUCNDFkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB1VydWd1YXlkZAIDDw8WAh8ABQ1QZXNvIFVydWd1YXlvZGQCBA8PFgIfAAUIMC4wOTg4NTJkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJVD2QWAmYPDxYCHxFoZGQCVg8PFgIfIwUCNDJkFgxmDw8WAh8RaGRkAgEPDxYEHwAFBiZuYnNwOx8RaGRkAgIPDxYCHwAFB1ZpZXRuYW1kZAIDDw8WAh8ABQREb25nZGQCBA8PFgIfAAUIMC4wMDAxNjJkZAIFDw8WBB8ABQYmbmJzcDsfEWhkZAJXD2QWAmYPDxYCHxFoZGQCAg8PZBYCHx4FDWRpc3BsYXk6bm9uZTsWAmYPPCsADQEADxYEBRtVc2VDb2x1bW5IZWFkZXJzQXNTZWxlY3RvcnNoBRhVc2VSb3dIZWFkZXJzQXNTZWxlY3RvcnNoDxYEHhNFbmFibGVFbWJlZGRlZFNraW5zaB8MaGRkAgMPFCsAAhQrAAIUKwACDxYOHxACAh8PBSVHcmlkQ29udGV4dE1lbnUgR3JpZENvbnRleHRNZW51X01ldHJvHwJnHwoFBU1ldHJvHwULKwQBHwtoHwZnZA8UKwABFCsAAg8WCh8ABQdDb2x1bW5zHgVWYWx1ZQUQQ29sdW1uc0NvbnRhaW5lch8PBQlyZ0hDTUNvbHMeCFBvc3RCYWNraB8QAgJkEBYDZgIBAgIWAxQrAAIPFgYfJQUvY3RsMDBfY3BoQ29udGVudF9yZ1RpcG9DYW1iaW9fY3RsMDB8c3RyX2Rlc1BhaXMfJmgfAAUEUEFJU2RkFCsAAg8WBh8lBTFjdGwwMF9jcGhDb250ZW50X3JnVGlwb0NhbWJpb19jdGwwMHxzdHJfZGVzTW9uZWRhHyZoHwAFBk1PTkVEQWRkFCsAAg8WBh8lBTRjdGwwMF9jcGhDb250ZW50X3JnVGlwb0NhbWJpb19jdGwwMHxzdHJfbnVtQ290aVNvbGVzHyZoHwAFFlRJUE8gREUgQ0FNQklPIChFbiBTLylkZA8WA2ZmZhYBBXNUZWxlcmlrLldlYi5VSS5SYWRNZW51SXRlbSwgVGVsZXJpay5XZWIuVUksIFZlcnNpb249MjAxNi4xLjIyNS40MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0xMjFmYWU3ODE2NWJhM2Q0DxQrAQFmFgEFc1RlbGVyaWsuV2ViLlVJLlJhZE1lbnVJdGVtLCBUZWxlcmlrLldlYi5VSSwgVmVyc2lvbj0yMDE2LjEuMjI1LjQwLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTEyMWZhZTc4MTY1YmEzZDRkZBYCZg8PFgofAAUHQ29sdW1ucx8lBRBDb2x1bW5zQ29udGFpbmVyHw8FCXJnSENNQ29scx8maB8QAgJkFgZmDw8WBh8lBS9jdGwwMF9jcGhDb250ZW50X3JnVGlwb0NhbWJpb19jdGwwMHxzdHJfZGVzUGFpcx8maB8ABQRQQUlTZGQCAQ8PFgYfJQUxY3RsMDBfY3BoQ29udGVudF9yZ1RpcG9DYW1iaW9fY3RsMDB8c3RyX2Rlc01vbmVkYR8maB8ABQZNT05FREFkZAICDw8WBh8lBTRjdGwwMF9jcGhDb250ZW50X3JnVGlwb0NhbWJpb19jdGwwMHxzdHJfbnVtQ290aVNvbGVzHyZoHwAFFlRJUE8gREUgQ0FNQklPIChFbiBTLylkZAIND2QWAgIBD2QWAgIBDxYCHwBkZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WCAUYY3RsMDAkY3BoQ29udGVudCRyZHBEYXRlBSFjdGwwMCRjcGhDb250ZW50JHJkcERhdGUkY2FsZW5kYXIFIWN0bDAwJGNwaENvbnRlbnQkcmRwRGF0ZSRjYWxlbmRhcgUdY3RsMDAkY3BoQ29udGVudCRyZ1RpcG9DYW1iaW8FJmN0bDAwJGNwaENvbnRlbnQkcmdUaXBvQ2FtYmlvJHJnaGNNZW51BV5jdGwwMCRjcGhDb250ZW50JHJnVGlwb0NhbWJpbyRyZ2hjTWVudSRpMCRpMCRjaGtjdGwwMCRjcGhDb250ZW50JHJnVGlwb0NhbWJpbyRjdGwwMHN0cl9kZXNQYWlzBWBjdGwwMCRjcGhDb250ZW50JHJnVGlwb0NhbWJpbyRyZ2hjTWVudSRpMCRpMSRjaGtjdGwwMCRjcGhDb250ZW50JHJnVGlwb0NhbWJpbyRjdGwwMHN0cl9kZXNNb25lZGEFY2N0bDAwJGNwaENvbnRlbnQkcmdUaXBvQ2FtYmlvJHJnaGNNZW51JGkwJGkyJGNoa2N0bDAwJGNwaENvbnRlbnQkcmdUaXBvQ2FtYmlvJGN0bDAwc3RyX251bUNvdGlTb2xlc6S0R0H6TDgmFXKIVJ4hn70Qhpxe0LJhZ8GV7bXxxnWg&__VIEWSTATEGENERATOR=8A5C9447&__EVENTVALIDATION=%2FwEdAAflMKsyTyib%2BzGxlyHjJUYwlawXGEyscjwHM2iJ%2B8drUdz81GR1o7NJCyAXkQgagG3oPDMR8cgDMq3ctkhYgDUUYOXpthTpsiyvd3VVRVRUqxG0QhVyn8o%2Fs84qwVK0NIQ84ZbkD733a15gVl%2FnxA8E7%2FrcWEaKCaQK87VkhYd1%2B1ymProTNQ5y3k2mCQ4n0NE%3D&__ASYNCPOST=true&ctl00%24cphContent%24btnConsultar=Consultar`;
  const response = await fetch(
    "https://www.sbs.gob.pe/app/pp/SISTIP_PORTAL/Paginas/Publicacion/TipoCambioContable.aspx",
    {
      headers: {
        "User-Agent":
          "Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0",
        Accept: "*/*",
        "Accept-Language": "en-US,en;q=0.5",
        "X-Requested-With": "XMLHttpRequest",
        "X-MicrosoftAjax": "Delta=true",
        "Cache-Control": "no-cache",
        "Content-Type": "application/x-www-form-urlencoded; charset=utf-8",
        "Sec-Fetch-Dest": "empty",
        "Sec-Fetch-Mode": "cors",
        "Sec-Fetch-Site": "same-origin",
        Pragma: "no-cache",
      },
      referrer:
        "https://www.sbs.gob.pe/app/pp/SISTIP_PORTAL/Paginas/Publicacion/TipoCambioContable.aspx",
      body: requestBody,
      method: "POST",
    }
  );
  const text = await response.text();
  return text;
}

function parseResponse(responseText: string) {
  const ind1 = responseText.indexOf(`<table class="rgMasterTable"`);
  const ind2 = responseText.indexOf(`</table>`, ind1);
  const html = responseText.slice(ind1, ind2 + 8);
  const $ = cheerio.load(html);
  const usd = $("thead").children().first().children();
  if ($(usd[0]).text() === "") {
    return [];
  }
  const currencies = [
    {
      region: $(usd[0]).text(),
      name: $(usd[1]).text(),
      rate: parseFloat($(usd[2]).text()),
    },
  ];
  const tbody = $("tbody").children();
  for (const currency of tbody.toArray()) {
    const parts = $(currency).children();
    currencies.push({
      region: $(parts[0]).text(),
      name: $(parts[1]).text(),
      rate: parseFloat($(parts[2]).text()),
    });
  }
  return currencies;
}

async function main() {
  const argv = process.argv.slice(2);
  // if (argv.length !== 1) {
  //   console.error('A date in the format YYYY-MM-DD must be provided.');
  //   process.exit(1);
  // }
  let date;
  if (argv.length === 0) {
    date = new Date().toLocaleDateString("fr-CA");
  } else {
    date = argv[0];
  }
  if (!date.match(/\d{4}-\d{2}-\d{2}/)) {
    console.error("A date in the format YYYY-MM-DD must be provided.");
    process.exit(1);
  }
  const responseText = await requestExchangeRates(date);
  const currencies = parseResponse(responseText);
  console.error(currencies);
  if (currencies.length === 0) {
    console.log("Exchange rate was not available on this date.");
  } else {
    console.log(JSON.stringify(currencies));
  }
}

main();
